
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	    <title>AI output viewer</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
        <script>
const createObjectURL = (object) => (window.URL) ? window.URL.createObjectURL(object) : window.webkitURL.createObjectURL(object)

const new_websocket = (dispatch) => {
  const ws = new WebSocket(`ws://${window.location.hostname}:${window.location.port}/ws`)
  ws.binaryType = "blob"
  ws.onclose = () => {
    console.log('ws close')
  }
  ws.onerror = (e) => {
    console.log('ws error')
    console.log(e)
  }
  ws.onopen = () => {
    console.log('ws open')
  }
  const textMsg = document.getElementById('main-title')
  const img = document.getElementById('main-img')

  ws.onmessage = (m) => {
    try {
        if (typeof m.data == "string") {
            const data = JSON.parse(m.data)
            textMsg.textContent = data.text;
        } else {
            const reader = new FileReader()
            reader.onload = e => img.src = e.target.result;
            reader.readAsDataURL(m.data)
        }
    }
    catch (e) {
      console.log(`Failed to deserialise websocket message`)
    }
  }
  return ws
}
        </script>
    </head>
	<body>
		<header>
			<div id="searchbar" class="elw"><div id="sbc" class="container">
				<h1 id="main-title">Say something...</h1>
			</div></div>
		</header>
		<div id="main-content" class="container">
			<img id="main-img" />
		</div>
        <script>
const ws = new_websocket()
        </script>
    </body>
</html>
